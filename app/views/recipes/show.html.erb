<div class="row page-header">

	<% if @recipe.user %>
		<div class="col-xs-2">
			<%= render "users/image", user: @recipe.user %>
		</div>
	<% end %>

	<div class="col-xs-10">
		<h1 class="recipe"><%= @recipe.name  %>
			<%= " - %s" % @recipe.variant_name if @recipe.variant_name%></h1>
		<p>Une recette de <%= render 'users/link', user: @recipe.user %></p>
	</div>

</div>


<div class="row">

	<div class="col-md-6">

		<div class="col-xs-6">
			<span class="label label-info">Type: <%= link_to @recipe.rtype ,  recipes_path( :type => @recipe.rtype )  %></span>
			<span class="label label-info">Saison: <%= link_to @recipe.season ,  recipes_path( :season => @recipe.season )  %></span>
		</div>

		<div class="col-xs-3">
			<%= image_tag "/assets/images/icons/views.svg" , class: "icon-recipe img-rounded"%> vue <%= @recipe.count_views %> fois
		</div>

		<div class="col-xs-3" style="text-align: right">
			<%= render 'shared/stars', stars: @recipe.rate.to_i %>
		</div>

		<div class=" col-xs-12">
			<%= image_tag @recipe.true_image_url , class: "img img-responsive full-width"%>
		</div>
			
	</div>

	<div class="col-md-6">

		<strong>Ingrédients</strong>
		<ul class="list-group">
			<% @recipe.ingredients.each_line do |ingredient|%>
				<li class="list-group-item"><%= link_to ingredient , recipes_path( :ingredients => ingredient )  %></li>
			<% end if @recipe.ingredients %>
		</ul>

		<strong>Temps</strong>
		<ul class="list-group">
			<% %w(cooking baking cooling rest).each do |time| %>
				<% time_of_recipe = @recipe.public_send("t_#{time}") %>
				
				<% if time_of_recipe.is_a? Time and time_of_recipe != Recipe::ZERO_TIME %>
					<li  class="list-group-item" >
						<time><%=time_of_recipe.strftime "%H:%M"%></time>
					</li>
				<% end %>
					
			<% end %>
		</ul>

		<div class="btn-group" role="group" aria-label="...">
			<%= link_to "sauvegarder", save_recipe_path(id: @recipe.id), :class => 'btn btn-primary' %>
			<!-- Add a fork button if the user is connected -->
			<%= link_to "créer une variante" , fork_recipe_path( :id => @recipe.id) , :class => 'btn btn-primary' %>
			<!-- if it's the owner of the recipe  -->
		</div>

		<p class="alert alert-info" role="alert">Cett recette vous a paru trop grasse? <%= link_to "Créez votre variante" , fork_recipe_path( :id => @recipe.id), class: 'alert-link' %>!</p>


		<% if current_user == @recipe.user %>
			<div class="btn-group" role="group" aria-label="...">
				<%= link_to "modifier" , edit_recipe_path , 
							:class => 'btn btn-warning'%>
				<%= link_to "supprimer" , @recipe ,
							:class => 'btn btn-danger',
							:method => :delete, 
							:confirm => 'Are you sure?' ,
							:title => "Delete #{@recipe.name}" %>
			</div>
		<% end %>

	</div>

</div>


<div class="row">
	<!-- forked recipes -->
	<% forked_recipes = @recipe.forked_recipes 
	if forked_recipes.length > 0 %>

		<h2>Variantes disponnibles</h2>
		<%= render 'shared/recipes' , :recipes => forked_recipes %>

	<% elsif @recipe.forked?  %>

		<h2>Recette originelle</h2>
		<%= render 'shared/recipe' , :recipe => @recipe.root_recipe %>

	<% end %>
</div>

<div class="row">
	<% if @recipe.steps %>
		<h2>Préparation</h2>
		<ul id="steps">
			<% @recipe.steps.each_line do |step|%>
				<li><span></span><%= step %></li>
			<% end %>
		</ul>
	<% end if @recipe.steps %>
</div>


<div class="row">
	<h2>Commentaires</h2>
	<%= render 'shared/comments', :comments => @recipe .comments %>
</div>